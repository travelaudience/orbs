description: |
  Submit test analysis to Code Climate.
  Using custom command that takes in additional flags (afrase/code-climate is broken)
parameters:
  additional_flags:
    description: Option to set prefix (or other params) (use "--prefix=v3")
    type: string
    default: ""
  coverage_file:
    description: The coverage file to format.
    type: string
    default: cover-source.out
  code_climate_file:
    description: The code climate file/path
    type: string
    default: coverage/codeclimate.json
steps:
  # TODO: is: grep -v '.pb.go' && grep -v '.pqt.go'
  #       needed for the coverage output file??
  - run: cc-test-reporter format-coverage <<parameters.additional_flags>> <<parameters.coverage_file>> --input-type=gocov --output=<<parameters.code_climate_file>>
  - code-climate/upload-coverage
