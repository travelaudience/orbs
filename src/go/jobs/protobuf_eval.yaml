description: Regenerate protobuf files to compare with auto-generated files pushed
parameters:
  exec:
    description: Executor to use for this job
    type: executor
    default: go_executor
  protobuf_version:
    description: The version of protobuf tool to install
    type: string
    default: "3.15.3"
  protoc_version:
    description: Version of protoc-gen-go to install
    default: "v1.4.3"
    type: string
executor: <<parameters.exec>>
steps:
  - protobuf/install:
      version: <<parameters.protobuf_version>>
  # as a work around to the permissions being broken in v3.6.1+
  #   neeed to run a chmod on these files
  - run: sudo ls -lf /usr/local/include/google
  - run: sudo ls -lf /usr/local/bin/protoc
  - run: sudo chmod -R +r /usr/local/include/google
  - run: sudo chmod +x /usr/local/bin/protoc
  - run: sudo ls -lf /usr/local/include/google
  - run: sudo ls -lf /usr/local/bin/protoc
  - checkout
  - go/load-cache
  - make-gen:
      protoc_version: <<parameters.protoc_version>>
  - compare
  - go/save-cache
