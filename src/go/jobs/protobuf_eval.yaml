description: Regenerate protobuf files to compare with auto-generated files pushed
parameters:
  exec:
    description: Executor to use for this job
    type: executor
    default: go_executor
  protobuf_version:
    description: The version of protobuf tool to install
    type: string
    default: "3.15.3"
  # protoc_version:
  #   description: Version of protoc-gen-go to install
  #   default: "v1.4.3"
  #   type: string
executor: <<parameters.exec>>
steps:
  - protobuf/install:
      version: <<parameters.protobuf_version>>
    # permissions are not as we'd like them by default
    # allow access to protobuf for all
  - run: sudo chmod -R +rX /usr/local/include/google
  - run: sudo chmod +x /usr/local/bin/protoc
  - checkout
  - go/load-cache
  - run: make gen
  - compare
  - go/save-cache
