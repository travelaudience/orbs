description: |
  Publish snapshot/release .jar depending on the version from a git tag.

parameters:
  executor:
    description: Executor to use for this job
    type: executor
    default: scala
  cache_key:
    description: Checksum-based key used to identify cache
    type: string
    default: ''

executor: << parameters.executor >>

steps:
  - read_workspace
  - read_cache:
      cache_key: << parameters.cache_key >>
  - run:
      name: Package .jar files
      command: sbt +package
  - run:
      name: Publish .jar files
      command: |
        #!/usr/bin/env bash
        VERSION_TAG=$(echo "$CIRCLE_TAG"   | grep -P -o '(?<=v).+')  # '1.0.0' without 'v' prefix
        echo 'Publishing '"$VERSION_TAG"' ...'
        sbt 'set ThisBuild / version := "'"$VERSION_TAG"'"' +publish
