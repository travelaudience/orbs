description: |
  Write sbt library dependencies to cache so it can be reused for multiple pipeline execution.
parameters:
  cache_key:
    description: Checksum-based key used to identify cache
    type: string
    default: ''
steps:
  - when:
      condition: << parameters.cache_key >>
      steps:
        - save_cache:
            key: << parameters.cache_key >>
            paths:
              - ~/.sbt
              - ~/.m2
              - ~/.ivy2/cache
              - ~/.cache/coursier
  - unless:
      condition: << parameters.cache_key >>
      steps:
        - run: cat build.sbt project/plugins.sbt project/Dependencies.scala 2>/dev/null >> cache_file || true
        - save_cache:
            key: v2-{{ checksum "cache_file" }}
            paths:
              - ~/.sbt
              - ~/.m2
              - ~/.ivy2/cache
              - ~/.cache/coursier
        - run: rm cache_file
