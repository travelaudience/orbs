description: |
  Publish scala snapshot/relaease library to nexus.

usage:
  version: 2.1

  orbs:
    ta-scala: travelaudience/scala@x.y.z
    #ta-scala: travelaudience/scala@dev:improve_scala_orb

  filter_snapshot_tags: &filter_snapshot_tags
    tags:
      # https://semver.org/#is-there-a-suggested-regular-expression-regex-to-check-a-semver-string
      only: /^v((([0-9]+)\.([0-9]+)\.([0-9]+)(?:-([0-9a-zA-Z-]+(?:\.[0-9a-zA-Z-]+)*))?)(?:\+([0-9a-zA-Z-]+(?:\.[0-9a-zA-Z-]+)*))?)$/

  filter_release_tags: &filter_release_tags
    tags:
      # 'v{major}.{minor}.{patch}'
      only: /^v\d+\.\d+\.\d+$/

  workflows:
    version: 2
    scala_publish_snapshot:
      # publish snapshot on any non-master commit
      jobs:
        - ta-scala/checkout_with_nexus_credentials:
            filters:
              tags:
                ignore: /.*/
              branches:
                ignore: master
        - ta-scala/run_static_checks:
            requires:
              - ta-scala/checkout_with_nexus_credentials
            filters:
              tags:
                ignore: /.*/
              branches:
                ignore: master
        - ta-scala/package:
            requires:
              - ta-scala/run_static_checks
            filters:
              tags:
                ignore: /.*/
              branches:
                ignore: master
        - ta-scala/publish_snapshot:
            requires:
              - ta-scala/package
            filters:
              tags:
                ignore: /.*/
              branches:
                ignore: master

    scala_publish_release:
      # publish release on tag only
      jobs:
        - ta-scala/checkout_with_nexus_credentials:
            filters:
              <<: *filter_release_tags
              branches:
                ignore: /.*/
        - ta-scala/run_static_checks:
            requires:
              - ta-scala/checkout_with_nexus_credentials
            filters:
              <<: *filter_release_tags
              branches:
                ignore: /.*/
        - ta-scala/package:
            requires:
              - ta-scala/run_static_checks
            filters:
              <<: *filter_release_tags
              branches:
                ignore: /.*/
        - ta-scala/publish_release:
            requires:
              - ta-scala/package
            filters:
              <<: *filter_release_tags
              branches:
                ignore: /.*/
